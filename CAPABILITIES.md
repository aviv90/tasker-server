# 🤖 Tasker Server - סקירת יכולות מלאה

## 📊 סטטיסטיקה כללית
- **כלים זמינים**: 26 כלים פעילים
- **ספקי AI**: 7 שירותים (Gemini, OpenAI, Grok, Replicate, ElevenLabs, Suno AI, Kie.ai)
- **שפות נתמכות**: עברית, אנגלית, וכל שפה שנתמכת ע"י ה-LLM
- **ארכיטקטורה**: Agent-based עם Gemini Function Calling

---

## 🎯 כלים לפי קטגוריות

### 🎨 יצירה (Creation) - 7 כלים

#### 1. `create_image` - יצירת תמונות
- **ספקים**: Gemini (ברירת מחדל), OpenAI DALL-E, Grok
- **תכונות**: תמיכה בבחירת ספק, fallback אוטומטי
- **דוגמאות**: `# צור תמונה של חתול`, `# תמונה עם OpenAI`

#### 2. `create_video` - יצירת וידאו
- **ספקים**: 
  - Veo 3 (Google) - איכות הכי גבוהה
  - Sora 2 (OpenAI) - סגנון קולנועי
  - Kling (Replicate) - מהיר, ברירת מחדל
- **תכונות**: Text-to-video, fallback אוטומטי
- **דוגמאות**: `# צור וידאו של גלים`, `# וידאו עם Veo 3`

#### 3. `image_to_video` - המרת תמונה לוידאו
- **ספקים**: Veo 3, Sora 2, Kling
- **תכונות**: אנימציית תמונה, הוראות תנועה
- **דוגמאות**: `[תמונה] # הפוך לווידאו`, `# הפוך לווידאו עם Veo 3`

#### 4. `create_music` - יצירת מוזיקה
- **ספק**: Suno AI
- **תכונות**: 
  - יצירה עם מילים
  - אינסטרומנטלי
  - יצירת וידאו מוזיקלי אופציונלי
- **דוגמאות**: `# צור שיר על אהבה`, `# שיר ג'אז אינסטרומנטלי`

#### 5. `create_poll` - יצירת סקרים
- **ספק**: Gemini + WhatsApp
- **תכונות**: 
  - 2-12 אפשרויות
  - אפשרות לחרוזים
  - יצירתיות גבוהה
- **דוגמאות**: `# צור סקר על פיצה`, `# סקר עם חרוזים`

#### 6. `create_group` - יצירת קבוצות WhatsApp
- **תכונות**:
  - פיענוח חכם של משתתפים
  - חיפוש מטושטש (fuzzy search)
  - יצירת תמונת פרופיל אוטומטית
  - הרשאות דינמיות
- **דוגמאות**: `# צור קבוצה משפחתית עם אבא ואמא`

#### 7. `send_location` - שליחת מיקום אקראי
- **תכונות**:
  - מיקומים מיבשת/מדינה/עיר
  - אזורי קרקע בלבד (לא ים/אוקיינוס)
  - 100,000+ מיקומים זמינים
- **דוגמאות**: `# שלח מיקום`, `# מיקום באירופה`

---

### 🔍 ניתוח (Analysis) - 3 כלים

#### 8. `analyze_image` - ניתוח תמונות
- **ספק**: Gemini Vision
- **תכונות**: תיאור מפורט, זיהוי אובייקטים, OCR
- **דוגמאות**: `[תמונה] # מה בתמונה?`

#### 9. `analyze_image_from_history` - ניתוח תמונה מצוטטת
- **ספק**: Gemini Vision
- **תכונות**: ניתוח תמונות מהיסטוריה
- **דוגמאות**: `[ציטוט תמונה] # מה הצבע?`

#### 10. `analyze_video` - ניתוח וידאו
- **ספק**: Gemini Video
- **תכונות**: תיאור תוכן, זיהוי פעולות
- **דוגמאות**: `[וידאו] # מה קורה בסרטון?`

---

### ✏️ עריכה (Editing) - 2 כלים

#### 11. `edit_image` - עריכת תמונות
- **ספקים**: OpenAI (ברירת מחדל), Gemini
- **תכונות**: שינוי אזורים, הוספת/הסרת אלמנטים
- **דוגמאות**: `[תמונה] # הוסף כובע`

#### 12. `edit_video` - עריכת וידאו
- **ספק**: Runway (בלבד)
- **תכונות**: עריכה מבוססת הוראות טקסט
- **דוגמאות**: `[וידאו] # שנה את הרקע לחוף`

---

### 🎤 אודיו וקול (Audio/Voice) - 6 כלים

#### 13. `text_to_speech` - המרת טקסט לדיבור
- **ספק**: ElevenLabs
- **תכונות**: 
  - בחירת קול אוטומטית
  - זיהוי שפה אוטומטי
  - 50+ קולות זמינים
- **דוגמאות**: `# אמור שלום`, `# תקרא את זה בקול`

#### 14. `translate_and_speak` - תרגום + דיבור
- **ספק**: Gemini + ElevenLabs
- **תכונות**: תרגום לכל שפה + המרה לדיבור
- **דוגמאות**: `# אמור "מה שלומך" בצרפתית`

#### 15. `translate_text` - תרגום טקסט בלבד
- **ספק**: Gemini
- **תכונות**: תרגום מדויק ל-100+ שפות
- **דוגמאות**: `# תרגם ל-ספרדית: שלום`

#### 16. `transcribe_audio` - תמלול אודיו
- **ספק**: Whisper (OpenAI)
- **תכונות**: תמלול מדויק, זיהוי שפה אוטומטי
- **דוגמאות**: `[אודיו] # תמלל`

#### 17. `voice_clone_and_speak` - שיבוט קול + דיבור
- **ספק**: ElevenLabs Instant Voice Cloning
- **תכונות**: שיבוט קול מדגם אודיו קצר (3+ שניות)
- **דוגמאות**: `[אודיו] # דבר בקול הזה: "היי"`

#### 18. `creative_audio_mix` - ערבוב אודיו יצירתי
- **ספק**: Custom (FFmpeg + Tone.js concepts)
- **תכונות**: 
  - 20+ אפקטים (reverb, delay, pitch shift...)
  - מוזיקת רקע אוטומטית
  - מיקס מתקדם
- **דוגמאות**: `[אודיו] # הוסף אקו ורברב`

---

### 🔍 חיפוש ומידע (Search & Info) - 1 כלי

#### 19. `search_web` - חיפוש אינטרנט
- **ספק**: Google Search (דרך Gemini Grounding)
- **תכונות**: 
  - חיפוש קישורים לתוכן קיים
  - ניתוח תוצאות חכם
  - פתרון redirects
- **דוגמאות**: `# חפש לי שיר של ביונסה`, `# מצא לינק לוויקיפדיה`

---

### 💭 הקשר וזיכרון (Context & Memory) - 4 כלים

#### 20. `get_chat_history` - שליפת היסטוריה
- **תכונות**: גישה ל-10 הודעות אחרונות
- **דוגמאות**: `# מה אמרתי קודם?`

#### 21. `get_long_term_memory` - זיכרון ארוך טווח
- **תכונות**: 
  - העדפות משתמש
  - סיכומי שיחות
  - מידע מתמשך
- **דוגמאות**: `# מה אני אוהב?`

#### 22. `save_user_preference` - שמירת העדפות
- **תכונות**: זיכרון קבוע של העדפות משתמש
- **דוגמאות**: `# תזכור שאני אוהב פיצה`

#### 23. `chat_summary` - סיכום שיחה
- **ספק**: Gemini
- **תכונות**: סיכום חכם של 20 הודעות אחרונות
- **דוגמאות**: `# סכם את השיחה`

---

### 🔄 מטא-כלים (Meta-Tools) - 3 כלים

#### 24. `retry_last_command` - חזרה על פקודה
- **תכונות**:
  - שינויים אופציונליים
  - תמיכה בכל סוגי הפקודות
  - cache של פקודה אחרונה
- **דוגמאות**: `# נסה שוב`, `# שוב אבל עם שיער ארוך`

#### 25. `retry_with_different_provider` - Fallback אוטומטי
- **תכונות**:
  - נסיון עם ספקים שונים אוטומטית
  - סדר עדיפויות מוגדר
  - Ack messages למשתמש
- **שימוש**: פנימי - קורה אוטומטית כשכלי נכשל

#### 26. `smart_execute_with_fallback` - ביצוע חכם עם fallback
- **תכונות**: ביצוע עמיד עם fallback מובנה
- **שימוש**: פנימי - משמש לכלים קריטיים

---

## 🔐 מערכת הרשאות

### ניהול הרשאות (Management Commands) - 11 פקודות

#### יצירת מדיה
1. `הוסף ליצירה [שם]` - הוסף משתמש
2. `הסר מיצירה [שם]` - הסר משתמש
3. `סטטוס יצירה` - הצג רשימה

#### תמלול אוטומטי
4. `הוסף לתמלול [שם]` - הוסף משתמש
5. `הסר מתמלול [שם]` - הסר משתמש
6. `סטטוס תמלול` - הצג רשימה

#### יצירת קבוצות
7. `הוסף לקבוצות [שם]` - הוסף משתמש
8. `הסר מקבוצות [שם]` - הסר משתמש
9. `סטטוס קבוצות` - הצג רשימה

#### מערכת
10. `עדכן אנשי קשר` - סנכרון מ-WhatsApp
11. `נקה היסטוריה` - מחק היסטוריות

**חשוב**: כל פקודות ההוספה/הסרה תומכות בפרמטר אופציונלי. אם לא מצוין שם - משתמש בקונטקט הנוכחי.

---

## 🎯 תכונות מתקדמות

### 1. **Multi-Step Planning** 🎭
- זיהוי אוטומטי של משימות רב-שלביות
- תכנון חכם עם Gemini
- ביצוע סדרתי עם Acks

### 2. **Automatic Fallback** 🔄
- נסיון אוטומטי עם ספקים שונים
- Acks למשתמש בכל נסיון
- שליחת שגיאות as-is

### 3. **Conversation Continuity** 💬
- זיכרון 10 הודעות אחרונות
- המשכיות טבעית
- הבנת הקשר

### 4. **Media Context** 📸
- זיהוי מדיה מצורפת (תמונה/וידאו/אודיו)
- תמיכה בציטוטים
- העברת context ל-Agent

### 5. **Authorization System** 🔐
- הרשאות דינמיות למדיה/תמלול/קבוצות
- בדיקה בסיסי נתונים
- תמיכה בקבוצות וצ'אטים פרטיים

### 6. **Retry Mechanism** 🔁
- cache של פקודה אחרונה
- תמיכה בשינויים
- עובד עם כל הכלים

### 7. **Voice Transcription** 🎤
- תמלול אוטומטי למורשים
- זיהוי שפה
- עיבוד אסינכרוני

### 8. **Smart URL Resolution** 🔗
- פתרון Google redirects
- זיהוי YouTube IDs
- ניקוי URLs

### 9. **Temporary File Management** 📁
- ניהול קבצים זמניים מרכזי
- ניקוי אוטומטי
- אימות כתיבה

### 10. **Error Handling** ❌
- שליחת שגיאות as-is
- Acks עקביים
- לוגים מפורטים

---

## 📊 ספקי שירות (Providers)

### AI & LLM
1. **Gemini** (Google) - Agent, תמונות, וידאו, טקסט, ניתוח
2. **OpenAI** - GPT-4, DALL-E, Whisper, Sora
3. **Grok** (X.ai) - תמונות, טקסט

### מדיה
4. **Replicate** - Kling (וידאו מהיר)
5. **Kie.ai** - Veo 3 proxy
6. **Suno AI** - מוזיקה
7. **ElevenLabs** - קול וTTS

### אחר
- **Google Search** - חיפוש אינטרנט (דרך Gemini Grounding)
- **FFmpeg** - עיבוד אודיו/וידאו
- **PostgreSQL** - אחסון נתונים

---

## 🎨 ארכיטקטורה

### Agent-Based System
```
User Message → Agent Router → Gemini Function Calling → Tool Selection → Execution → Response
```

### Key Components
- **agentService.js** - מנוע ראשי
- **multiStepPlanner.js** - תכנון רב-שלבי
- **tools/** - 26 כלים מודולריים
- **conversationManager.js** - ניהול היסטוריה
- **authorization** - מערכת הרשאות

### Database Schema
- **conversations** - היסטוריית שיחות
- **voice_allow_list** - הרשאות תמלול
- **media_creation_auth** - הרשאות מדיה
- **group_creation_auth** - הרשאות קבוצות
- **contacts** - אנשי קשר
- **last_commands** - cache פקודות
- **agent_context** - זיכרון Agent
- **conversation_summaries** - סיכומים

---

## 🔧 טכנולוגיות

- **Node.js** + Express
- **PostgreSQL** (via better-sqlite3)
- **Green API** (WhatsApp)
- **Gemini Function Calling**
- **FFmpeg** (אודיו/וידאו)
- **Heroku** (deployment)

---

## 📈 סטטיסטיקות קוד

- **קבצים**: ~100 קבצים
- **שורות קוד**: ~15,000 שורות
- **כלים**: 26 כלים פעילים
- **שירותים**: 15+ שירותים מודולריים
- **נקודות אינטגרציה**: 7 ספקי AI

---

## 🎯 עקרונות קוד

✅ **SOLID** - Single Responsibility, Dependency Inversion
✅ **DRY** - Don't Repeat Yourself
✅ **SSOT** - Single Source of Truth
✅ **Modularity** - כל קובץ < 500 שורות
✅ **Clean Code** - שמות ברורים, תיעוד מלא
✅ **Error Handling** - שליחת שגיאות למשתמש
✅ **Performance** - קריאות מקבילות, caching

---

**נוצר**: נובמבר 2024
**גרסה**: 2.0 (לאחר Refactoring הגדול)
**מצב**: ✅ ייצור מלא

