---
description: Every command or intent detection must be forgiving and include all possible variations
---

# Forgiving Commands

Every command or intent detection must be **forgiving** towards the user and include **all possible variations**.

---

## ğŸ¯ **Core Principle:**

**The user shouldn't need to think about how to phrase the command - the bot should understand any reasonable phrasing!**

---

## ğŸ“‹ **Implementation Requirements:**

### 1ï¸âƒ£ **All Hebrew Conjugations**

In Hebrew, words change according to:
- **Masculine singular**: ××—×§, ×ª××—×§, ×”×•×¨×“, ×ª×•×¨×™×“
- **Feminine singular**: ××—×§×™, ×ª××—×§×™, ×”×•×¨×™×“×™, ×ª×•×¨×™×“×™  
- **Plural**: ××—×§×•, ×ª××—×§×•, ×”×•×¨×™×“×•, ×ª×•×¨×™×“×•
- **Base forms**: ×¡×™×¨, ×¦×•×¨, ×¦×™×™×¨, ×©× ×”, ×©×¤×¨

**Correct example:**
```javascript
// âœ… Correct - all conjugations:
const isEditRequest = /××—×§|××—×§×™|××—×§×•|×ª××—×§|×ª××—×§×™|×ª××—×§×•|×”×•×¨×“|×”×•×¨×™×“×™|×”×•×¨×™×“×•|×ª×•×¨×™×“|×ª×•×¨×™×“×™|×ª×•×¨×™×“×•/i

// âŒ Wrong - only one form:
const isEditRequest = /××—×§|×”×•×¨×“|×ª×•×¨×™×“/i
```

---

### 2ï¸âƒ£ **Both Languages - Hebrew and English**

Every command must work in both Hebrew and English:

```javascript
// âœ… Correct:
const isLocation = /×©×œ×—.*××™×§×•×|send.*location|××™×§×•×|location/i

// âŒ Wrong - only Hebrew:
const isLocation = /×©×œ×—.*××™×§×•×/i
```

---

### 3ï¸âƒ£ **Different Phrasing Patterns**

Support all natural phrasing patterns:

#### **Example - Region Selection:**
```javascript
// âœ… Correct - all patterns:
const patterns = [
  /×‘××–×•×¨\s+(\w+)/i,           // "×‘××–×•×¨ ×¡×œ×•×‘× ×™×”"
  /×‘-?(\w+)/i,                 // "×‘×¡×œ×•×‘× ×™×”", "×‘-×¡×œ×•×‘× ×™×”"
  /\b(\w+)\b/i,                // "×¡×œ×•×‘× ×™×”"
  /in\s+(the\s+)?(region\s+of\s+)?(\w+)/i,  // "in slovenia", "in region of slovenia"
  /in\s+(\w+)/i                // "in slovenia"
];
```

#### **Example - TTS Commands:**
```javascript
// âœ… Correct - all variations:
const isTTS = /×××•×¨|×××¨×™|×××¨×•|×ª×××¨|×ª×××¨×™|×ª×××¨×•|×”×§×¨×|×”×§×¨××™|×”×§×¨××•|×ª×§×¨×|×ª×§×¨××™|×ª×§×¨××•|×‘×§×•×œ|×§×•×œ×™×ª|say|speak|tell|voice|read\s+aloud/i

// âŒ Wrong - only partial variations:
const isTTS = /×××•×¨|say/i
```

---

### 4ï¸âƒ£ **Partial Phrases and Abbreviations**

Support partial phrases and abbreviations:

```javascript
// âœ… Correct - supports abbreviations too:
const isLocation = /×©×œ×—.*××™×§×•×|××™×§×•×|send.*location|location/i

// Examples that will work:
// "×©×œ×— ××™×§×•×" âœ…
// "××™×§×•×" âœ…
// "send location" âœ…
// "location" âœ…
```

---

### 5ï¸âƒ£ **LLM Router Support**

When using LLM Router (`INTENT_ROUTER_USE_LLM='on'`), the prompt must include:

- âœ… All Hebrew variations
- âœ… All English variations
- âœ… Examples of all possible phrasings
- âœ… Explicit note that the command should be forgiving

**Example LLM Prompt:**
```
ğŸ”¹ **Location Command:**
   Hebrew keywords: "×©×œ×— ××™×§×•×", "××™×§×•×", "×‘××–×•×¨ X", "×‘-X", "××–×•×¨ X"
   English keywords: "send location", "location", "in X", "in region X"
   â†’ "send_random_location"
   
   Examples:
   - "×©×œ×— ××™×§×•×" â†’ send_random_location
   - "×©×œ×— ××™×§×•× ×‘××–×•×¨ ×¡×œ×•×‘× ×™×”" â†’ send_random_location (with region filter)
   - "send location in japan" â†’ send_random_location (with region filter)
   - "××™×§×•×" â†’ send_random_location
```

---

## âœ… **Principles:**

1. **No "correct phrasing"** - any reasonable phrasing should work
2. **Case-insensitive** - always use `/i` flag
3. **Maximum flexibility** - prefer more patterns than fewer
4. **Both languages** - always Hebrew + English
5. **All conjugations** - all relevant Hebrew conjugations

---

## ğŸ“‚ **Relevant Files:**

1. **`services/intentRouter.js`** - regex patterns (lines ~56-276)
2. **`services/intentRouter.js`** - `buildRouterPrompt()` function (lines ~396+)
3. **`routes/whatsappRoutes.js`** - any command processing function

---

## ğŸ¯ **Implementation Examples:**

### **Example 1: Location Command**
```javascript
// âœ… Correct - all variations:
const isLocation = /×©×œ×—.*××™×§×•×|××™×§×•×|send.*location|location|××™×§×•×.*××§×¨××™|random.*location/i

// Also support regions:
const regionPatterns = [
  /×‘××–×•×¨\s+(\w+)/i,
  /×‘-?(\w+)/i,
  /\b(\w+)\b/i,
  /in\s+(\w+)/i
];
```

### **Example 2: TTS Command**
```javascript
// âœ… Correct - all conjugations and patterns:
const isTTS = /×××•×¨|×××¨×™|×××¨×•|×ª×××¨|×ª×××¨×™|×ª×××¨×•|×”×§×¨×|×”×§×¨××™|×”×§×¨××•|×ª×§×¨×|×ª×§×¨××™|×ª×§×¨××•|×‘×§×•×œ|×§×•×œ×™×ª|say|speak|tell|voice|read\s+aloud/i

// Also support languages:
const languagePatterns = {
  'he': /×‘?×¢×‘×¨×™×ª|hebrew/i,
  'en': /×‘?×× ×’×œ×™×ª|english/i,
  'ja': /×‘?×™×¤× ×™×ª|japanese/i,
  // ... all languages
};
```

---

## ğŸš« **What NOT to Do:**

âŒ **Don't do:**
```javascript
// Only one form - not enough!
const isLocation = /×©×œ×— ××™×§×•×/i

// Only Hebrew - not enough!
const isLocation = /×©×œ×—.*××™×§×•×/i

// Case-sensitive - not enough!
const isLocation = /×©×œ×—.*××™×§×•×/
```

---

## ğŸ’¡ **Tips:**

1. **Test with real users** - how did they phrase the command?
2. **Add more patterns** - better too many than too few
3. **Always test** - try all variations
4. **Document in JSDoc** - list all supported variations

---

## âœ… **Goal:**

**Smooth user experience** - users can phrase commands however they want, and the bot will always understand! ğŸ¯
