# Rule 11: Prompts and Acks Separation

## Overview
All prompts (LLM/system instructions) and acknowledgment messages must be separated from business logic code and centralized in dedicated configuration files.

---

## 1. Prompts Separation

### âœ… **Do:**
- **Store ALL prompts in `config/prompts.js`**
  - System instructions for LLMs (Gemini, OpenAI, Grok)
  - Multi-step planner prompts
  - Agent routing prompts
  - Single-step execution prompts
  - Tool descriptions and usage examples

- **Use SSOT (Single Source of Truth)**
  - Import prompts from centralized config
  - No hardcoded prompts in service files
  - No prompt duplication across files

- **Organize by purpose:**
  ```javascript
  module.exports = {
    // Agent-related prompts
    agentSystemInstruction: (lang) => `...`,
    multiStepPlanner: `...`,
    singleStepInstruction: `...`,
    
    // Service-specific prompts
    geminiImageGeneration: `...`,
    translateInstruction: (targetLang) => `...`,
    
    // Tool descriptions (imported from tools-list.js)
  };
  ```

### âŒ **Don't:**
- Don't hardcode prompts in route handlers
- Don't duplicate prompts across services
- Don't mix prompts with business logic
- Don't scatter prompts in different files

---

## 2. Acknowledgment Messages (Acks)

### âœ… **Do:**
- **Store ALL Acks in centralized config**
  - Current location: `services/whatsapp/messaging.js` (sendAck function)
  - Agent Acks: `services/agent/config/constants.js` (TOOL_ACK_MESSAGES)

- **Ensure consistency across execution modes:**
  - **Single-step commands** (direct handlers) â†’ Use same Ack format
  - **Multi-step commands** (Agent/Planner) â†’ Use same Ack format
  - Example: "ğŸ¨ ×™×•×¦×¨ ×ª××•× ×” ×¢× Gemini..." (both modes)

- **Include provider names where relevant:**
  - Image generation: "×™×•×¦×¨ ×ª××•× ×” ×¢× [Gemini/OpenAI/Grok]..."
  - Video generation: "×™×•×¦×¨ ×•×™×“××• ×¢× [Veo 3/Sora 2/Kling]..."
  - Video editing: "×¢×•×¨×š ×•×™×“××• ×¢× Runway..." (only provider)
  - Translation: "××ª×¨×’× ×¢× Gemini..."

- **Use placeholders for dynamic providers:**
  ```javascript
  TOOL_ACK_MESSAGES: {
    create_image: 'ğŸ¨ ×™×•×¦×¨ ×ª××•× ×” ×¢× __PROVIDER__...',
    create_video: 'ğŸ¬ ×™×•×¦×¨ ×•×™×“××• ×¢× __PROVIDER__...',
    edit_video: 'ğŸï¸ ×¢×•×¨×š ×•×™×“××• ×¢× Runway...' // Fixed provider
  }
  ```

### âŒ **Don't:**
- Don't use different Ack formats for same operation
- Don't hardcode Acks in route handlers
- Don't send Acks without provider names (when multiple providers exist)
- Don't duplicate Ack logic across files

---

## 3. Current Implementation Status

### âœ… **Already Separated:**
- **Prompts:** `config/prompts.js` contains all LLM prompts
- **Tool Descriptions:** `config/tools-list.js` (SSOT for tools)
- **Agent Acks:** `services/agent/config/constants.js` (TOOL_ACK_MESSAGES)
- **WhatsApp Acks:** `services/whatsapp/messaging.js` (sendAck function)

### ğŸ¯ **Consistency Achieved:**
- Agent tools use `TOOL_ACK_MESSAGES` with provider placeholders
- WhatsApp handlers use `sendAck()` function
- Fallback mechanism sends Acks for each provider attempt
- No hardcoded Acks in business logic

---

## 4. Example: How It Works

### **Multi-step command (Agent):**
```javascript
// User: "×¦×•×¨ ×ª××•× ×” ×©×œ ×—×ª×•×œ"
// 1. Planner decides: create_image with provider=gemini
// 2. Agent sends: "ğŸ¨ ×™×•×¦×¨ ×ª××•× ×” ×¢× Gemini..." (from TOOL_ACK_MESSAGES)
// 3. If fails â†’ Fallback to OpenAI
// 4. Agent sends: "ğŸ¨ ×™×•×¦×¨ ×ª××•× ×” ×¢× OpenAI..." (same format!)
```

### **Single-step command (Direct handler):**
```javascript
// User: "# Gemini ×¦×•×¨ ×ª××•× ×” ×©×œ ×—×ª×•×œ"
// 1. Router identifies: gemini_image command
// 2. Handler sends: "ğŸ¨ ×§×™×‘×œ×ª×™! ××™×™×¦×¨ ×ª××•× ×” ×¢× Gemini..." (from sendAck)
```

**Result:** Consistent user experience! âœ…

---

## 5. Benefits

âœ… **Maintainability:** Change Acks/prompts in one place  
âœ… **Consistency:** Same messages across all execution paths  
âœ… **Testability:** Easy to test prompt changes  
âœ… **Clarity:** Business logic is clean, no prompt clutter  
âœ… **SSOT:** Single source of truth for all user-facing text  

---

## 6. When Adding New Features

**Always ask:**
1. Does this feature need a prompt? â†’ Add to `config/prompts.js`
2. Does this feature need an Ack? â†’ Add to `messaging.js` or `constants.js`
3. Is this a new AI tool? â†’ Add to `config/tools-list.js` + `TOOL_ACK_MESSAGES`
4. Does it support multiple providers? â†’ Use `__PROVIDER__` placeholder

**Never:**
- âŒ Hardcode prompts in service files
- âŒ Duplicate Ack messages
- âŒ Mix prompt logic with business logic
